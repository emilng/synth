!function e(t,n,a){function i(u,r){if(!n[u]){if(!t[u]){var s="function"==typeof require&&require;if(!r&&s)return s(u,!0);if(o)return o(u,!0);var l=new Error("Cannot find module '"+u+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[u]={exports:{}};t[u][0].call(c.exports,function(e){var n=t[u][1][e];return i(n?n:e)},c,c.exports,e,t,n,a)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<a.length;u++)i(a[u]);return i}({1:[function(e){var t=e("./data/data.js"),n=e("./audio/generateNoteMappings.js"),a=e("./audio/updateOctave.js"),i=e("./ui/initKeyboard.js"),o=e("./ui/clickHandlers.js"),u=e("./ui/keyHandlers"),r=e("./ui/updateEnvelopeVisual.js"),s=e("./ui/updateEnvelopeTable.js"),l=e("./ui/updateKeyboard.js"),c=e("./ui/drawVisualizer.js"),d=function(e){var t=c(e),n=s(e),a=r(e),i=function(){e.notesChanged&&(l(e),e.notesChanged=!1),e.envelopeChanged&&(a(),n(),e.envelopeChanged=!1),t(),requestAnimationFrame(i)};return i},v=function(){var e=window.AudioContext=window.AudioContext||window.webkitAudioContext,r=new e,s=r.createGain();s.gain.value=.5,t.ui.keyChars.forEach(function(e,n){var a=r.createOscillator();a.start(0),t.audio.oscillatorNodes[n]=a;var i=r.createGain();i.gain.setValueAtTime(0,0),t.audio.gainNodes[n]=i,a.connect(i),i.connect(s)});var l=r.createDynamicsCompressor(),c=r.createAnalyser();s.connect(l),l.connect(c),c.connect(r.destination),t.audio.context=r,t.audio.masterGain=s,t.audio.analyser=c,t.audio.activeNotes=t.ui.keyChars.map(function(){return!1}),t.audio.notes=n(),t.ui.keyboard=i(t),o.noteClick(t),o.octaveClick(t),a(t,0);var v=d(t);requestAnimationFrame(v),document.addEventListener("mouseup",o.noteOff(t)),document.addEventListener("keydown",u.keyDown(t)),document.addEventListener("keyup",u.keyUp(t))};window.addEventListener("load",v,!1)},{"./audio/generateNoteMappings.js":2,"./audio/updateOctave.js":5,"./data/data.js":6,"./ui/clickHandlers.js":7,"./ui/drawVisualizer.js":8,"./ui/initKeyboard.js":10,"./ui/keyHandlers":11,"./ui/updateEnvelopeTable.js":12,"./ui/updateEnvelopeVisual.js":13,"./ui/updateKeyboard.js":14}],2:[function(e,t){var n=function(){for(var e=1.059463094359,t=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],n=440,a=-4,i=3,o=21+i,u=[],r=0;88>r;){var s=r+i,l=s%12,c=Math.floor(s/12),d=n*Math.pow(e,12*a+s),v=r+o;u.push({frequency:d,midi:v,name:t[l],octave:c}),r++}return u};t.exports=n},{}],3:[function(e,t){var n=function(e,t){var n=10,a=e.audio,i=e.audio.envelope,o=a.context.currentTime,u=function(e){var t=a.gainNodes[e];if(t){t.gain.cancelScheduledValues(o),t.gain.setValueAtTime(t.gain.value,o);var u=o+i.releaseTime*n;t.gain.linearRampToValueAtTime(0,u)}a.activeNotes[e]=!1},r=void 0!==t&&a.activeNotes[t]===!0;r?u(t):a.activeNotes=a.activeNotes.map(function(e,t){return e&&u(t),!1}),e.notesChanged=!0};t.exports=n},{}],4:[function(e,t){var n=function(e,t){var n=2.3,a=10,i=20,o=e.audio,u=o.octave;t>=o.activeNotes.length&&(u++,t-=o.activeNotes.length);var r=o.activeNotes[t];if(!r){var s=e.audio.envelope,l=o.context.currentTime;o.activeNotes[t]=!0;var c=o.notes,d=12*u+t;if(d<c.length-1){var v=c[d],m=o.oscillatorNodes[t],f=o.gainNodes[t];m.type=m.SINE,m.noteIndex=d,m.frequency.value=v.frequency;var p=l+.01,y=p+s.delayTime*n,g=y+s.attackTime*a,h=g+s.decayTime*i;f.gain.cancelScheduledValues(l),f.gain.setValueAtTime(f.gain.value,l),f.gain.setValueAtTime(s.delayValue,p),f.gain.linearRampToValueAtTime(s.delayValue,y),f.gain.linearRampToValueAtTime(s.attackValue,g),f.gain.linearRampToValueAtTime(s.decayValue,h),e.notesChanged=!0}}};t.exports=n},{}],5:[function(e,t){var n=function(e,t){var n=e.audio;n.octave=Math.max(0,Math.min(6,n.octave+t));var a=document.getElementById("octave-display");a.innerHTML="Octave "+n.octave};t.exports=n},{}],6:[function(e,t){var n={audio:{context:null,gainNodes:[],oscillatorNodes:[],masterGain:null,analyser:null,octave:3,notes:null,envelope:{delayTime:0,attackTime:.1,decayTime:.1,sustainTime:0,releaseTime:.1,delayValue:0,attackValue:1,decayValue:.5,sustainValue:.5,releaseValue:0},activeNotes:null},ui:{keyChars:["A","W","S","E","D","F","T","G","Y","H","U","J","K","O","L","P",";","'"],keyboard:null,keyDimensions:null,keyOffsets:[],envelope:{propNames:["delay","attack","decay","sustain","release"],width:400,height:150,minSpacing:20,maxSpacing:60,marginY:20,marginX:25,releaseMin:295}},notesChanged:!0,envelopeChanged:!0};t.exports=n},{}],7:[function(e,t,n){var a=e("../audio/noteOn.js"),i=e("../audio/noteOff.js"),o=e("../audio/updateOctave.js"),u=function(e){for(var t=function(e,t){return function(){a(e,t)}},n=0;18>n;){var i=document.getElementById("key-"+n);i.addEventListener("mousedown",t(e,n)),n++}},r=function(e){var t=function(e,t){return function(){o(e,t)}},n=document.getElementById("octave-down");n.addEventListener("click",t(e,-1));var a=document.getElementById("octave-up");a.addEventListener("click",t(e,1))},s=function(e){return function(){i(e)}};n.noteClick=u,n.octaveClick=r,n.noteOff=s},{"../audio/noteOff.js":3,"../audio/noteOn.js":4,"../audio/updateOctave.js":5}],8:[function(e,t){var n=function(e){var t=document.getElementById("visualizer"),n=e.audio.analyser;n.fftSize=2048;var a=n.fftSize,i=new Uint8Array(a),o=t.getContext("2d"),u=t.width,r=t.height,s=function(){n.getByteTimeDomainData(i),o.clearRect(0,0,u,r),o.fillStyle="#EEE",o.fillRect(0,0,u,r),o.beginPath();for(var e=u*(1/a),t=0,s=0;a>s;s++){var l=i[s]/128,c=l*r/2;0===s?o.moveTo(t,c):o.lineTo(t,c),t+=e}o.lineTo(u,r/2),o.stroke()};return s};t.exports=n},{}],9:[function(e,t){var n=function(e,t){var n=e.audio.envelope,a=e.ui.envelope,i=document.getElementById("svg-envelope"),o=a.height,u=a.minSpacing,r=a.maxSpacing,s=a.marginY,l=o-2*s,c=function(e,t,n){return Math.min(Math.max(e,t),n)},d=function(a){var o=i.getBoundingClientRect(),s=a.clientX-o.left,l=c(s-(t.previousX+u),0,r),d=l/r;n[t.name+"Time"]=d,e.envelopeChanged=!0},v=function(a){var o=i.getBoundingClientRect(),u=a.clientY-o.top,r=c(u-s,0,l),v=1-r/l;n[t.name+"Value"]=v,("sustain"===t.name||"decay"===t.name)&&(n.decayValue=v,n.sustainValue=v),"sustain"!==t.name&&d(a),e.envelopeChanged=!0},m=function(){i.style.cursor="",document.removeEventListener("mousemove",d),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",m)},f=function(){i.style.cursor="ew-resize",document.addEventListener("mousemove",d),document.addEventListener("mouseup",m)},p=function(){i.style.cursor="sustain"===t.name?"ns-resize":"move",document.addEventListener("mousemove",v),document.addEventListener("mouseup",m)},y=function(){""===i.style.cursor&&(t.timeRect.style.cursor="ew-resize")},g=function(){""===i.style.cursor&&(t.timeRect.style.cursor="")},h=function(){""===i.style.cursor&&(t.valueTimeRect.style.cursor="sustain"===t.name?"ns-resize":"move")},E=function(){""===i.style.cursor&&(t.valueTimeRect.style.cursor="")};"sustain"!==t.name&&(t.timeRect.addEventListener("mousedown",f),t.timeRect.addEventListener("mouseover",y),t.timeRect.addEventListener("mouseleave",g)),"release"!==t.name&&(t.valueTimeRect.addEventListener("mousedown",p),t.valueTimeRect.addEventListener("mouseover",h),t.valueTimeRect.addEventListener("mouseleave",E))};t.exports=n},{}],10:[function(e,t){var n=function(e){var t=document.createElement("canvas");t.width=400,t.height=30;var n=t.getContext("2d"),a=e.ui.keyDimensions={black:{width:4,height:14},white:{width:6,height:22}},i=Math.round(a.white.width/2);n.strokeStyle="#000",n.lineWidth=1,n.fillStyle="#000";for(var o=87,u=0,r=e.audio.notes,s=e.ui.keyOffsets,l=0;o>l;l++)1===r[l].name.length?(s.push(u),u+=a.white.width):s.push(u-i+1);return s.map(function(e,t){1===r[t].name.length&&n.strokeRect(e,0,a.white.width,a.white.height)}),s.map(function(e,t){2===r[t].name.length&&n.fillRect(e,0,a.black.width,a.black.height)}),n.getImageData(0,0,t.width,t.height)};t.exports=n},{}],11:[function(e,t,n){var a=e("../audio/noteOn.js"),i=e("../audio/noteOff.js"),o=e("../audio/updateOctave.js"),u=function(e,t){var n;return n=186===t||59===t?";":222===t||39===t?"'":String.fromCharCode(t),e.ui.keyChars.indexOf(n)},r=function(e){return function(t){var n=t.keyCode;if(!(t.ctrlKey||t.altKey||t.shiftKey||t.metaKey)){var i=u(e,n);i>-1&&(a(e,i),t.preventDefault());var r=String.fromCharCode(n);"Z"===r?o(e,-1):"X"===r&&o(e,1)}}},s=function(e){return function(t){var n=u(e,t.keyCode);n>-1&&i(e,n)}};n.keyUp=s,n.keyDown=r},{"../audio/noteOff.js":3,"../audio/noteOn.js":4,"../audio/updateOctave.js":5}],12:[function(e,t){var n=function(e){var t=e.audio.envelope,n=e.ui.envelope,a=function(e,t){var n=document.getElementById(e),a={element:n,name:t};return n?a:null},i=n.propNames.reduce(function(e,t){var n=a(t+"-time-cell",t+"Time"),i=a(t+"-value-cell",t+"Value");return n&&e.push(n),i&&e.push(i),e},[]);i.forEach(function(n){n.element.addEventListener("change",function(){t[n.name]=parseInt(n.element.value,10)/100,e.envelopeChanged=!0})});var o=function(){i.forEach(function(e){var n=t[e.name];e.element.value=100*n})};return o};t.exports=n},{}],13:[function(e,t){var n=e("./envelopeMouseHandlers.js"),a=function(e){var t=e.audio.envelope,a=e.ui.envelope,i=a.height,o=a.releaseMin,u=a.minSpacing,r=a.maxSpacing,s=a.marginX,l=a.marginY,c=i-l,d=i-2*l,v=a.propNames.reduce(function(t,a){var i={timeLine:document.getElementById("envelope-"+a+"-time"),valueLine:document.getElementById("envelope-"+a+"-value"),label:document.getElementById("envelope-"+a+"-label"),timeRect:document.getElementById("envelope-"+a+"-time-rect"),valueTimeRect:document.getElementById("envelope-"+a+"-value-time-rect"),value:a+"Value",time:a+"Time",name:a,previousX:0};return n(e,i),t.push(i),t},[]),m=function(e,t,n,a,i){e.setAttributeNS(null,"x1",t),e.setAttributeNS(null,"y1",n),e.setAttributeNS(null,"x2",a),e.setAttributeNS(null,"y2",i)},f=function(e,t,n){e.setAttributeNS(null,"x",t),e.setAttributeNS(null,"y",n)},p=function(e,t,n,a,i){e.setAttributeNS(null,"x",t),e.setAttributeNS(null,"y",n),e.setAttributeNS(null,"width",a),e.setAttributeNS(null,"height",i)},y=function(){var e=c-t.delayValue*d,n=s;v.forEach(function(a){var s=c-t[a.value]*d,l=n+u+t[a.time]*r;a.previousX=n,l="sustain"===a.name?o:l,m(a.valueLine,n,e,l,s),m(a.timeLine,l,0,l,i),f(a.label,n+3,c+12),"sustain"!==a.name&&p(a.timeRect,l-5,0,10,i),"release"!==a.name&&p(a.valueTimeRect,l-5,s-5,10,10),n=l,e=s})};return y};t.exports=a},{"./envelopeMouseHandlers.js":9}],14:[function(e,t){var n=function(e){var t=e.audio,n=e.ui,a=document.getElementById("full-keyboard"),i=a.getContext("2d");i.putImageData(n.keyboard,0,0),i.fillStyle="rgba(140,140,140,0.8)",t.activeNotes.map(function(e,a){var o=document.getElementById("key-"+a),u=n.keyOffsets[12*t.octave+a],r=t.notes[12*t.octave+a],s=1===r.name.length?"white":"black";e?(i.fillRect(u,0,n.keyDimensions[s].width,n.keyDimensions[s].height),o.setAttribute("class","down-"+s+"-key")):o.setAttribute("class",s+"-key")})};t.exports=n},{}]},{},[1]);
//# sourceMappingURL=synth.min.js.map